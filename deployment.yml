# configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: testingdemostracion-config
  namespace: default
data:
  LOG_LEVEL: "debug"
  FEATURE_FLAG: "true"

---
# namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: default

---
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: testingdemostracion
  labels:
    app: testingdemostracion
spec:
  replicas: 3
  selector:
    matchLabels:
      app: testingdemostracion
  template:
    metadata:
      labels:
        app: testingdemostracion
    spec:
      containers:
        - name: app
          image: testingdemostracion:latest
          ports:
            - containerPort: 8080
          # ensure your server listens on 0.0.0.0
          # e.g. command: ["./server", "--host", "0.0.0.0", "--port", "8080"]

---
# service-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
  name: testingdemostracion
spec:
  type: LoadBalancer
  selector:
    app: testingdemostracion
  ports:
    - name: http
      protocol: TCP
      port: 8080        # cluster-internal port
      targetPort: 8080  # must match containerPort
      nodePort: 30080   # on each Node: 30000â€“32767

---
# netpol.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-app
  namespace: default
spec:
  podSelector:
    matchLabels:
      app: testingdemostracion
  ingress:
    - from:
        - podSelector: {}
      ports:
        - protocol: TCP
          port: 8080
